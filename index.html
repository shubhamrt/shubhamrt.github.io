<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Shubham Tiwari | Dryland Connectivity</title>

<link id="site-favicon" rel="icon" type="image/png" href="img/logo.png">

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,600;1,700&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --text:#fff;

    /* Faster reveal */
    --in-delay:.02s;
    --in-dur:.28s;
    --reveal-delay:400ms;

    /* Page 2 */
    --p2-bg:#ffffff;
    --p2-ink:#1b2622;
    --p2-line:rgba(0,0,0,.10);

    /* Accent */
    --accent:#2C7873;
    --accent-hover:#215f5b;

    /* Layout */
    --nav-h:70px;
    --max:1100px;

    /* Compact but clear */
    --p2-base:15px;

    /* Side column width (helps signature stay on one line) */
    --side-w:360px;

    /* Art strip */
    --sand:#f3efe6;
  }

  *{box-sizing:border-box}
  html{scroll-behavior:smooth}
  html,body{height:100%;margin:0}
  body{background:#000;color:var(--text);font-family:Inter,system-ui,Arial,Helvetica,sans-serif}
  img{display:block;max-width:100%}
  a{color:inherit}
  section{scroll-margin-top: calc(var(--nav-h) + 16px);}

  /* ---------------- HERO ---------------- */
  .hero{
    position:relative;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
    overflow:hidden;
    color:var(--text);
    background:#122d27 url('img/banner_contours.jpg') center/cover no-repeat fixed;
    isolation:isolate;
  }
  /* Fix iOS/Safari "fixed background" issues */
  @media (max-width: 900px){
    .hero{ background-attachment: scroll; }
  }

  .film{
    position:absolute; inset:0;
    background:rgba(0,0,0,.25);
    opacity:0;
    transition:opacity var(--in-dur) ease var(--in-delay);
    z-index:1;
  }
  .reveal .film{opacity:1}

  /* ---------------- NAV (desktop + mobile burger) ---------------- */
  .navband{
    position:fixed;
    top:0; left:0; right:0;
    height:var(--nav-h);
    z-index:20;

    opacity:0;
    transform:translateY(-8px);
    transition:
      opacity var(--in-dur) ease var(--in-delay),
      transform var(--in-dur) ease var(--in-delay);
    pointer-events:none;
  }
  .reveal .navband{
    opacity:1;
    transform:translateY(0);
    pointer-events:auto;
  }

  .nav-surface{
    position:absolute; inset:0;
    background:rgba(0,0,0,.18);
    border-bottom:1px solid rgba(255,255,255,.18);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }
  body.scrolled .nav-surface{
    background:rgba(255,255,255,.94);
    border-bottom:1px solid rgba(0,0,0,.10);
  }

  .nav-inner{
    position:relative;
    height:100%;
    width:min(var(--max), calc(100% - 48px));
    margin:0 auto;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:18px;
  }

  .nav-brand{
    font-weight:800;
    letter-spacing:.2px;
    font-size:clamp(18px,1.7vw,20px);
    text-decoration:none;
    text-shadow:0 2px 8px rgba(0,0,0,.45);
    white-space:nowrap;
  }
  body.scrolled .nav-brand{ color:var(--p2-ink); text-shadow:none; }

  /* Desktop links -> separate pages */
  .nav-links{
    display:flex;
    align-items:center;
    gap:12px;
    flex-wrap:wrap;
    justify-content:flex-end;
  }
  .nav-links a{
    color:var(--text);
    text-decoration:none;
    font-weight:700;
    font-size:16px;
    padding:11px 14px;
    border-radius:999px;
    transition:background .2s ease, transform .2s ease, color .2s ease;
    text-shadow:0 2px 8px rgba(0,0,0,.35);
  }
  .nav-links a:hover{ background:rgba(255,255,255,.10); transform:translateY(-1px); }
  .nav-links a:focus-visible{ outline:3px solid rgba(44,120,115,.45); outline-offset:2px; }
  body.scrolled .nav-links a{ color:var(--p2-ink); text-shadow:none; }
  body.scrolled .nav-links a:hover{ background:rgba(44,120,115,.10); }

  /* Mobile burger */
  .nav-toggle{
    display:none;
    width:44px; height:44px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.22);
    background:rgba(0,0,0,.12);
    color:#fff;
    cursor:pointer;
    align-items:center;
    justify-content:center;
  }
  .nav-toggle span,.nav-toggle span::before,.nav-toggle span::after{
    content:"";
    display:block;
    width:18px;
    height:2px;
    background:currentColor;
    border-radius:2px;
  }
  .nav-toggle span{position:relative;}
  .nav-toggle span::before{position:absolute; top:-6px; left:0;}
  .nav-toggle span::after{position:absolute; top:6px; left:0;}

  body.scrolled .nav-toggle{
    color:var(--p2-ink);
    border-color:rgba(0,0,0,.14);
    background:rgba(255,255,255,.75);
  }

  .nav-drawer{
    position:absolute;
    right:0;
    top:calc(var(--nav-h) - 6px);
    width:min(260px, calc(100vw - 24px));
    padding:10px;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.18);
    background:rgba(0,0,0,.30);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    box-shadow:0 18px 40px rgba(0,0,0,.25);
    opacity:0;
    transform:translateY(-6px);
    pointer-events:none;
    transition:opacity .18s ease, transform .18s ease;
  }
  .nav-drawer.open{
    opacity:1;
    transform:translateY(0);
    pointer-events:auto;
  }
  .nav-drawer a{
    display:block;
    padding:12px 12px;
    border-radius:12px;
    text-decoration:none;
    font-weight:750;
    color:#fff;
  }
  .nav-drawer a:hover{ background:rgba(255,255,255,.10); }

  body.scrolled .nav-drawer{
    background:rgba(255,255,255,.96);
    border-color:rgba(0,0,0,.10);
  }
  body.scrolled .nav-drawer a{ color:var(--p2-ink); }
  body.scrolled .nav-drawer a:hover{ background:rgba(44,120,115,.10); }

  @media (max-width:640px){
    :root{ --nav-h:78px; }
    .nav-inner{ width:calc(100% - 24px); }
    .nav-links{ display:none; }
    .nav-toggle{ display:inline-flex; }
  }

  /* ---------------- HERO CONTENT ---------------- */
  .hero-inner{
    position:relative;
    z-index:2;
    padding:24px;
    margin-top:var(--nav-h);
    opacity:0;
    transition:opacity var(--in-dur) ease var(--in-delay);
    transform:translateY(-1.2cm);
  }
  .reveal .hero-inner{opacity:1}

  .logo{
    width:min(200px,35vw);
    height:auto;
    margin:clamp(-40px,-12vh,-200px) auto 18px;
    filter:drop-shadow(0 6px 25px rgba(0,0,0,.35));
  }
  h1{
    font-family:Spectral,serif;
    font-size:clamp(27px,4.64vw,51.2px);
    line-height:1.06;
    margin:0;
    text-shadow:0 2px 10px rgba(0,0,0,.35);
    font-weight:700;
  }
  .hero-em{white-space:nowrap; font-style:italic; font-weight:600; letter-spacing:.2px}

  @media (max-width:520px){
    .hero-inner{ transform:translateY(-0.5cm); padding:18px; }
    .logo{ margin:clamp(-26px,-8vh,-120px) auto 14px; }
  }

  /* ---------------- PAGE 2 ---------------- */
  .page2{
    background:var(--p2-bg);
    color:var(--p2-ink);
    padding: 56px 24px 26px; /* minimal bottom padding */
    font-size:var(--p2-base);
  }
  .page2-wrap{max-width:var(--max); margin:0 auto;}

  .hello{
    font-family:Inter,system-ui,sans-serif;
    font-weight:800;
    letter-spacing:-.02em;
    font-size:clamp(34px,3.2vw,44px);
    line-height:1.08;
    margin:0 0 14px;
  }
  .lede{
    font-size:1.02em;
    line-height:1.66;
    color:rgba(27,38,34,.86);
    margin:0 0 18px;
    max-width:80ch;
  }
  .lede .q{
    color:var(--accent);
    font-weight:850;
    text-decoration: underline;
    text-decoration-thickness: 2px;
    text-underline-offset: 3px;
  }

  .two-col{
    display:grid;
    grid-template-columns: 1fr;
    gap:20px;
    align-items:start;
  }
  @media (min-width: 920px){
    .two-col{ grid-template-columns: 1fr var(--side-w); gap:32px; }
  }

  .prose{
    font-size:1em;
    line-height:1.72;
    color:rgba(27,38,34,.88);
    max-width:84ch;
  }
  .prose p{ margin:0 0 12px; }
  .prose p:last-child{ margin-bottom:0; }

  .prose a{
    color:var(--accent);
    text-decoration: underline;
    text-decoration-thickness: 1.5px;
    text-underline-offset: 3px;
  }
  .prose a:hover{ color:var(--accent-hover); }

  .side{
    display:grid;
    gap:10px;
    justify-items:end;
  }

  .portrait{
    width:100%;
    max-width:var(--side-w);
    border:1px solid var(--p2-line);
    padding:6px;
    background:#fff;
  }
  .portrait img{ width:100%; height:auto; display:block; }
  .portrait.fallback{
    height:420px;
    display:grid;
    place-items:center;
    color:rgba(27,38,34,.55);
    background:linear-gradient(180deg, rgba(44,120,115,.10), rgba(0,0,0,.02));
  }

  .profile-meta{
    width:100%;
    max-width:var(--side-w);
    color:rgba(27,38,34,.82);
    font-size:13.2px;
    line-height:1.45;
    padding-top:2px;
  }
  .profile-meta .name{
    font-weight:800;
    color:rgba(27,38,34,.92);
    margin-bottom:6px;
    font-size:14.4px;
  }
  .profile-meta .line{ margin:0 0 6px; }
  .profile-meta .gap{ margin-top:10px; }
  .profile-meta a{
    color:var(--accent);
    text-decoration: underline;
    text-decoration-thickness: 1.5px;
    text-underline-offset: 3px;
    font-weight:650;
  }
  .profile-meta a:hover{ color:var(--accent-hover); }

  /* Horizontal links like signature */
  .signature{
    width:100%;
    max-width:var(--side-w);
    display:flex;
    gap:16px;
    flex-wrap:wrap;
    align-items:center;
    color:rgba(27,38,34,.78);
    font-size:13.2px;
    line-height:1.4;
    padding-top:2px;
  }
  .signature a{
    color:var(--accent);
    text-decoration: underline;
    text-decoration-thickness: 1.5px;
    text-underline-offset: 3px;
    font-weight:700;
    white-space:nowrap;
  }
  .signature a:hover{ color:var(--accent-hover); }

  /* Mobile: center image; keep signature/links left-aligned */
  @media (max-width: 919px){
    :root{ --side-w: 420px; } /* bigger image on mobile */
    .side{ justify-items:center; }
    .portrait{ justify-self:center; }
    .profile-meta, .signature{ justify-self:start; text-align:left; }
  }

  /* ---------------- Art strip (footer) ---------------- */
  .art-strip{
    margin-top:22px;
    width:100vw;
    margin-left:calc(50% - 50vw);
    background:var(--sand);
    border-top:1px solid rgba(0,0,0,.08);
    overflow:hidden;
  }
  .art-strip svg{ display:block; width:100%; height:auto; }
  .art-caption{
    max-width:var(--max);
    margin:0 auto;
    padding:10px 24px 14px;
    color:rgba(27,38,34,.62);
    font-size:12.5px;
  }

  @media (prefers-reduced-motion: reduce){
    html{scroll-behavior:auto}
    .film, .navband, .hero-inner{transition:none; opacity:1; transform:none;}
    .nav-drawer{transition:none}
  }
</style>
</head>

<body>

<!-- TOP NAV BAND -->
<div class="navband" role="navigation" aria-label="Primary">
  <div class="nav-surface" aria-hidden="true"></div>

  <div class="nav-inner">
    <a class="nav-brand" href="#about">Shubham Tiwari</a>

    <!-- Desktop links open new pages -->
    <div class="nav-links" aria-label="Site sections">
      <a href="research.html">Research</a>
      <a href="key-concepts.html">Key Concept</a>
      <a href="news.html">News</a>
    </div>

    <!-- Mobile burger -->
    <button class="nav-toggle" id="navToggle" aria-label="Open menu" aria-controls="navDrawer" aria-expanded="false">
      <span></span>
    </button>

    <div class="nav-drawer" id="navDrawer" aria-hidden="true">
      <a href="research.html">Research</a>
      <a href="key-concepts.html">Key Concept</a>
      <a href="news.html">News</a>
    </div>
  </div>
</div>

<!-- PAGE 1: HERO -->
<header class="hero" id="top" role="banner" aria-label="Intro">
  <div class="film" aria-hidden="true"></div>

  <div class="hero-inner">
    <img class="logo" src="img/logo.png" alt="Site logo">
    <h1>
      Connectivity that guides<br>
      <span class="hero-em">resilient drylands</span>
    </h1>
  </div>
</header>

<!-- PAGE 2: ABOUT -->
<section id="about" class="page2" aria-label="About">
  <div class="page2-wrap">

    <h2 class="hello">Hey there, I'm Shubham.</h2>
    <p class="lede">
      I'm fascinated by a question that drives most of my research:
      <span class="q">How do dryland landscapes fall apart and how can we see it coming before it's too late?</span>
    </p>

    <div class="two-col">
      <div class="prose">
        <p>
          Right now, I'm a postdoctoral researcher at
          <a href="https://nmsu.edu/" target="_blank" rel="noreferrer">New Mexico State University</a>,
          working to understand dust source dynamics across the western United States. Before this, I spent my PhD at
          <a href="https://www.durham.ac.uk/" target="_blank" rel="noreferrer">Durham University</a>
          developing a network-based approach to dryland degradation. Essentially, I taught myself to see landscapes as living systems of connections rather than just collections of soil and plants.
        </p>

        <p>
          Drylands cover about 40% of Earth's land surface and support billions of people. When they degrade, the consequences ripple outward: dust storms, lost livelihoods, entire ecosystems shifting into new states. But degradation doesn't happen uniformly. It flows through the landscape along pathways of water, wind and vegetation. If we can map these pathways, we can identify where systems are vulnerable and intervene before collapse.
        </p>

        <p>
          My journey has taken me from grasslands in the southwestern USA to floodplains in Austria, from analyzing rainfall networks in Australia's Murray-Darling Basin to flying drones over semi-arid hillslopes in Arizona. Along the way, I've earned a
          <a href="https://marie-sklodowska-curie-actions.ec.europa.eu/" target="_blank" rel="noreferrer">Marie Sk≈Çodowska-Curie</a>
          fellowship and worked as one of the youngest Senior Hydrologists in the UK's
          <a href="https://www.gov.uk/government/organisations/environment-agency" target="_blank" rel="noreferrer">Environment Agency</a>.
        </p>

        <p>
          What excites me most is bridging fundamental science and real-world action. During my PhD, I focused on water-driven erosion and how vegetation patterns control landscape stability. Now I'm extending that thinking to wind-driven processes and dust emission. Different erosive forces, same underlying question: What makes a landscape resilient and what tips it over the edge?
        </p>

        <p>
          I use complex network theory alongside traditional geomorphic modeling. It's a way of seeing patterns that conventional approaches might miss, of identifying critical thresholds before they're crossed. And ultimately, I want to translate this research into tools that land managers can actually use.
        </p>

        <p>
          Thanks for stopping by. Feel free to explore my research or reach out if you want to chat about drylands, networks or anything in between.
        </p>
      </div>

      <aside class="side" aria-label="Profile">
        <div class="portrait">
          <img src="img/profile.jpg" alt="Portrait of Shubham Tiwari"
               onerror="this.style.display='none'; this.parentElement.classList.add('fallback'); this.parentElement.textContent='Add img/profile.jpg';">
        </div>

        <div class="profile-meta" aria-label="Profile details">
          <div class="name">Dr Shubham Tiwari</div>

          <div class="line">Senior Hydrologist, Environment Agency, DEFRA UK</div>
          <div class="line">Marie Curie Early-Stage Researcher, i-CONN project</div>
          <div class="line">Incoming postdoctoral researcher, New Mexico State University</div>

          <div class="gap"></div>

          <div class="line">Tel: +44 7586782408</div>
          <div class="line">Email: <a href="mailto:shubham.tiwari@environment-agency.gov.uk">shubham.tiwari@environment-agency.gov.uk</a></div>
        </div>

        <div class="signature" aria-label="Links">
          <a href="CV_shubham_tiwari_290126.pdf">CV</a>
          <a href="https://linkedin.com/in/shubhamrt" target="_blank" rel="noreferrer">LinkedIn</a>
          <a href="https://scholar.google.com/citations?user=xdspNSQAAAAJ&hl=en" target="_blank" rel="noreferrer">Google Scholar</a>
          <a href="https://x.com/EcoGeoNetwork" target="_blank" rel="noreferrer">X</a>
        </div>
      </aside>
    </div>

  </div>

  <!-- Decorative strip: more realistic dryland / ranch scene -->
  <div class="art-strip" aria-hidden="true">
    <svg viewBox="0 0 1600 180" preserveAspectRatio="none">
      <!-- base -->
      <rect x="0" y="0" width="1600" height="180" fill="var(--sand)"/>

      <!-- bunting string -->
      <path d="M0 24H1600" stroke="rgba(27,38,34,.14)" stroke-width="2"/>

      <!-- bunting flags -->
      <g fill="var(--accent)" opacity=".60">
        <path d="M20 26h26l-13 18z"/><path d="M70 26h26l-13 18z"/><path d="M120 26h26l-13 18z"/>
        <path d="M170 26h26l-13 18z"/><path d="M220 26h26l-13 18z"/><path d="M270 26h26l-13 18z"/>
        <path d="M320 26h26l-13 18z"/><path d="M370 26h26l-13 18z"/><path d="M420 26h26l-13 18z"/>
        <path d="M470 26h26l-13 18z"/><path d="M520 26h26l-13 18z"/><path d="M570 26h26l-13 18z"/>
        <path d="M620 26h26l-13 18z"/><path d="M670 26h26l-13 18z"/><path d="M720 26h26l-13 18z"/>
        <path d="M770 26h26l-13 18z"/><path d="M820 26h26l-13 18z"/><path d="M870 26h26l-13 18z"/>
        <path d="M920 26h26l-13 18z"/><path d="M970 26h26l-13 18z"/><path d="M1020 26h26l-13 18z"/>
        <path d="M1070 26h26l-13 18z"/><path d="M1120 26h26l-13 18z"/><path d="M1170 26h26l-13 18z"/>
        <path d="M1220 26h26l-13 18z"/><path d="M1270 26h26l-13 18z"/><path d="M1320 26h26l-13 18z"/>
        <path d="M1370 26h26l-13 18z"/><path d="M1420 26h26l-13 18z"/><path d="M1470 26h26l-13 18z"/>
        <path d="M1520 26h26l-13 18z"/>
      </g>

      <!-- distant mesas -->
      <g fill="rgba(27,38,34,.06)">
        <path d="M120 76 L260 40 L420 76 Z"/>
        <path d="M520 76 L690 36 L860 76 Z"/>
        <path d="M980 76 L1125 42 L1280 76 Z"/>
        <path d="M1320 76 L1460 44 L1600 76 Z"/>
      </g>

      <!-- sun (soft) -->
      <circle cx="1320" cy="52" r="22" fill="rgba(44,120,115,.10)"/>

      <!-- birds -->
      <g fill="none" stroke="rgba(27,38,34,.18)" stroke-width="2" stroke-linecap="round">
        <path d="M1080 54 q10 -8 20 0"/>
        <path d="M1100 54 q10 -8 20 0"/>
        <path d="M280 52 q10 -8 20 0"/>
        <path d="M300 52 q10 -8 20 0"/>
      </g>

      <!-- midground hills -->
      <path
        d="M0 110 C 220 88, 380 128, 560 108
           C 740 88, 900 132, 1080 110
           C 1260 88, 1420 126, 1600 108
           L1600 180 L0 180 Z"
        fill="rgba(44,120,115,.10)"/>

      <!-- foreground dunes -->
      <path
        d="M0 140 C 260 122, 420 156, 620 140
           C 820 124, 1040 164, 1220 144
           C 1400 124, 1520 150, 1600 142
           L1600 180 L0 180 Z"
        fill="rgba(44,120,115,.14)"/>

      <!-- fence line -->
      <g stroke="rgba(27,38,34,.18)" stroke-width="2" fill="none" opacity=".9">
        <path d="M0 128H1600"/>
        <path d="M100 128v20"/><path d="M200 128v20"/><path d="M300 128v20"/><path d="M400 128v20"/>
        <path d="M500 128v20"/><path d="M600 128v20"/><path d="M700 128v20"/><path d="M800 128v20"/>
        <path d="M900 128v20"/><path d="M1000 128v20"/><path d="M1100 128v20"/><path d="M1200 128v20"/>
        <path d="M1300 128v20"/><path d="M1400 128v20"/><path d="M1500 128v20"/>
      </g>

      <!-- saguaros -->
      <g fill="none" stroke="var(--accent)" stroke-width="7" stroke-linecap="round" stroke-linejoin="round" opacity=".85">
        <path d="M250 148 V98"/>
        <path d="M250 110 C250 100 230 100 230 112 V126"/>
        <path d="M250 114 C250 104 270 104 270 116 V130"/>

        <path d="M820 152 V88"/>
        <path d="M820 106 C820 92 792 92 792 110 V134"/>
        <path d="M820 112 C820 96 852 96 852 116 V138"/>

        <path d="M1370 150 V96"/>
        <path d="M1370 114 C1370 100 1346 100 1346 116 V134"/>
      </g>

      <!-- shrubs -->
      <g fill="rgba(27,38,34,.10)" opacity=".9">
        <ellipse cx="560" cy="152" rx="18" ry="6"/>
        <ellipse cx="590" cy="154" rx="14" ry="5"/>
        <ellipse cx="1010" cy="154" rx="16" ry="5"/>
        <ellipse cx="1035" cy="156" rx="12" ry="4"/>
      </g>

      <!-- ranch: barn + windmill -->
      <g opacity=".28" fill="rgba(27,38,34,.55)">
        <path d="M108 146 L150 118 L192 146 V168 H108 Z"/>
        <rect x="144" y="146" width="12" height="22" fill="rgba(27,38,34,.50)"/>
        <rect x="320" y="120" width="6" height="48"/>
        <path d="M323 118 l-16 10 l16 10 l16-10z"/>
      </g>

      <!-- cattle -->
      <g fill="rgba(27,38,34,.18)" opacity=".95">
        <path d="M1180 156
                 c10-10 30-10 40 0
                 l18 0 c6 0 10 4 10 10
                 c0 6-4 10-10 10
                 l-6 0 l-2 10 h-10 l-2-10
                 h-22 l-2 10 h-10 l-2-10
                 c-10 0-18-8-18-18 c0-6 3-10 6-12z"/>

        <path d="M520 158
                 c8-8 24-8 32 0
                 l14 0 c5 0 9 4 9 9
                 c0 6-4 10-10 10
                 l-5 0 l-2 9 h-8 l-2-9
                 h-18 l-2 9 h-8 l-2-9
                 c-8 0-14-7-14-15 c0-5 2-8 4-10z"/>
      </g>

      <path d="M0 168H1600" stroke="rgba(27,38,34,.10)" stroke-width="2"/>
    </svg>

    <div class="art-caption">Dryland-inspired strip (decorative).</div>
  </div>
</section>

<script>
(function(){
  // Reveal quickly
  setTimeout(()=>document.body.classList.add('reveal'), 400);

  // nav style on scroll
  const onScroll = () => document.body.classList.toggle('scrolled', window.scrollY > 40);
  onScroll();
  window.addEventListener('scroll', onScroll, {passive:true});

  // mobile drawer
  const btn = document.getElementById('navToggle');
  const drawer = document.getElementById('navDrawer');
  const openDrawer = (open) => {
    if(!btn || !drawer) return;
    drawer.classList.toggle('open', open);
    btn.setAttribute('aria-expanded', open ? 'true' : 'false');
    drawer.setAttribute('aria-hidden', open ? 'false' : 'true');
  };

  if(btn && drawer){
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      openDrawer(!drawer.classList.contains('open'));
    });

    document.addEventListener('click', (e) => {
      if(drawer.classList.contains('open') && !drawer.contains(e.target) && !btn.contains(e.target)){
        openDrawer(false);
      }
    });

    document.addEventListener('keydown', (e) => {
      if(e.key === 'Escape') openDrawer(false);
    });
  }

  // Favicon: black circle + white logo (so it doesn't look like a black dot)
  const faviconLink = document.getElementById('site-favicon');
  const logoImg = new Image();
  logoImg.src = 'img/logo.png';
  logoImg.onload = () => {
    try{
      const size = 256;
      const canvas = document.createElement('canvas');
      canvas.width = size; canvas.height = size;
      const ctx = canvas.getContext('2d');

      // black circle background
      ctx.fillStyle = '#000';
      ctx.beginPath();
      ctx.arc(size/2, size/2, size/2 - 6, 0, Math.PI*2);
      ctx.closePath();
      ctx.fill();

      // draw logo, then mask to white
      const off = document.createElement('canvas');
      off.width = size; off.height = size;
      const o = off.getContext('2d');

      const target = size * 0.78; // bigger so it's clearly visible
      const s = Math.min(target / logoImg.width, target / logoImg.height);
      const w = logoImg.width * s;
      const h = logoImg.height * s;
      const x = (size - w) / 2;
      const y = (size - h) / 2;

      o.drawImage(logoImg, x, y, w, h);
      o.globalCompositeOperation = 'source-in';
      o.fillStyle = '#fff';
      o.fillRect(0,0,size,size);
      o.globalCompositeOperation = 'source-over';

      ctx.drawImage(off, 0, 0);

      faviconLink.type = 'image/png';
      faviconLink.href = canvas.toDataURL('image/png');
    }catch(err){
      // fallback stays as img/logo.png
    }
  };
})();
</script>

</body>
</html>
